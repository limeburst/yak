#!/usr/bin/python

import argparse
import os

def init(args):
    from pkgutil import get_data

    root_files = ['_config.py']
    static_files = ['style.css', 'favicon.ico']
    template_files = ['post.html', 'atom.xml', 'archive.html', 'index.html', 'base.html']
    post_files = ['2012-01-01-hello-world.md']

    dirs = [
            ('_static', static_files),
            ('_templates', template_files),
            ('_posts', post_files),
            ] 

    for file in root_files:
        with open(os.path.join(args.dest, file), 'w') as f:
            f.write(get_data('yak', os.path.join('data', file)))

    for dir in dirs:
        os.mkdir(os.path.join(args.dest, dir[0]))
        for file in dir[1]:
            with open(os.path.join(args.dest, dir[0], file), 'w') as f:
                f.write(get_data('yak', os.path.join('data', file)))

    print """Basic Yak blog structure has been created in '{}'.

Be sure to edit the '_config.py' configuration file before baking your blog.""".format(args.dest)

def bake(args):
    print 'bake'

def serve(args):
    print 'serve'

def watch(args):
    print 'watch'

parser = argparse.ArgumentParser(description="Yak makes baking and managing static blogs easy.")

subparsers = parser.add_subparsers(help='sub-command help')

parser_init = subparsers.add_parser('init', help='Initialize a basic Yak blog directory structucture.')
parser_init.add_argument('dest', nargs='?', default='.')
parser_init.set_defaults(func=init)

parser_bake = subparsers.add_parser('bake', help='Bake the Yak blog.')
parser_bake.add_argument('src', nargs='?', default='.')
parser_bake.add_argument('dest', nargs='?', default='_site')
parser_bake.set_defaults(func=bake)

parser_serve = subparsers.add_parser('serve', help='Start the Yak blog management server.')
parser_serve.add_argument('src', default='.')
parser_serve.add_argument('-p', default=5000, type=int)
parser_serve.set_defaults(func=serve)

parser_watch = subparsers.add_parser('watch', help='Watch for changes in the posts directory.')
parser_watch.add_argument('src', nargs='?', default='_posts')
parser_watch.set_defaults(func=watch)

args = parser.parse_args()
args.func(args)
